"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1838],{1838:function(e,t,r){r.d(t,{$:function(){return de}});var n=r(85893),o=r(67294),i=r(35797),s=r(69150),a=r(62282),c=r(32009),l=r(18426),u=r(17724),d=r(59499),v=r(64595),p=r(29428),f=r(69027),m=r(92354),b=r(72113),g=r(96012);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const h=(0,b.N)()((e=>{const{fetchOptions:t}=e,{apis:{favoritesV1:r},baseUrl:n}=(0,g.asConfigV2)(g.config).services.apiPlatform,o=m.Z.buildURLWithParams(new URL(r.endpointPaths.list_items,n),{});return{fetch:()=>(0,f.U2)(o,O(O({},t),{},{credentials:"include",errorTag:"get_favorites_v1_api_error",timerTag:"get_favorites_v1_api_call"})),url:o,options:e}}));function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const P="@web/domain-guest/get-favorites-v1",_="@web/domain-guest/guestFavorites",k=3e5,{useQuery:D}=(0,v.J)({name:P,defaultOptions:{staleTime:k,cacheTime:k},keyFn:e=>[P,e],queryFn:async(e,t)=>{await(0,p.rz)(_,p.ZP);const r=await p.ZP.get(_);if(null!==r&&void 0!==r&&r.list_items)return r;const n=h({}),{data:o,ok:i,statusText:s}=await n.fetch();if(i)return await p.ZP.set(_,o,null!==t&&void 0!==t&&t.cacheTime?Date.now()+t.cacheTime:void 0),o;throw new Error(`${s}`)}}),C=(e,t)=>{var r;const n=(0,l.bC)();return D(w(w({},e),{},{guest_id:n}),w(w({},t),{},{enabled:(null===(r=null===t||void 0===t?void 0:t.enabled)||void 0===r||r)&&Boolean(n)}))};C.queryName=D.queryName;const x=(0,l.Hv)(C,{minimumAssuranceLevel:l.Jr});var M=r(98689),T=r(52383);function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const S=(0,b.N)()((e=>{const{fetchOptions:t,requestParams:r}=null!==e&&void 0!==e?e:{},{apis:{favoritesV1:n},baseUrl:o}=(0,g.asConfigV2)(g.config).services.apiPlatform,i=m.Z.buildURLWithParams(new URL(n.endpointPaths.list_items,o),{});return{fetch:()=>(0,f.v_)(i,E(E({},t),{},{credentials:"include",body:JSON.stringify(r),errorTag:"post_favorites_v1_api_error",timerTag:"post_favorites_v1_api_call"})),options:e,url:i}}));function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const{useMutation:Z}=(0,M.F)({name:"@web/domain-guest/add-favorite-v1",mutationFn:async e=>{const t=S({requestParams:e}),r=await t.fetch();return null===r||void 0===r?void 0:r.data}}),J=e=>{const[t,r]=Z(e);return[async e=>{var r;const n=await t(L({},e)),o=await p.ZP.get(_),i=L(L({},o),{},{list_items:[n,...null!==(r=null===o||void 0===o?void 0:o.list_items)&&void 0!==r?r:[]]});return await p.ZP.set(_,i,Date.now()+k),await(0,T.Dm)(P),n},r]};J.mutationName=Z.mutationName;const I=(0,l.tW)(J,{minimumAssuranceLevel:l.Jr});var R=r(59681);function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const A=(0,b.N)()((e=>{const{fetchOptions:t,requestParams:r}=null!==e&&void 0!==e?e:{},{apis:{favoritesV1:n},baseUrl:o}=(0,g.asConfigV2)(g.config).services.apiPlatform,i=null===r||void 0===r?void 0:r.list_item_id,s=m.Z.buildURLWithParams(new URL(`${n.endpointPaths.list_items}/${i}`,o),{});return{fetch:()=>(0,f.IV)(s,U(U({},t),{},{credentials:"include",errorTag:"delete_favorites_v1_api_error",timerTag:"delete_favorites_v1_api_call"})),options:e,url:s}}));function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const{useMutation:V}=(0,M.F)({name:"@web/domain-guest/remove-favorite",mutationFn:async e=>{const t=A({requestParams:e}),r=await t.fetch();return null===r||void 0===r?void 0:r.data}}),$=e=>{const[t,r]=V(e);return[async e=>{const r=await t(q({},e)),n=await p.ZP.get(_),o=null===n||void 0===n?void 0:n.list_items,i=null===o||void 0===o?void 0:o.filter(R.y).filter((e=>"TCIN"!==(null===e||void 0===e?void 0:e.item_type)||(null===e||void 0===e?void 0:e.tcin)!==(null===r||void 0===r?void 0:r.tcin))),s=q(q({},n),{},{list_items:i});return await p.ZP.set(_,s,Date.now()+k),await(0,T.Dm)(P),r},r]};$.mutationName=V.mutationName;const H=(0,l.tW)($,{minimumAssuranceLevel:l.Jr});var W=r(49018),G=r(26306),Q=r(60713),K=r(53131),X=r(93862);let Y;const ee=(0,K.No)(Y||(Y=(e=>e)`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation"><path d="M21.67 6.224c-1.284-2.093-3.4-3.065-5.741-2.617-1.436.375-2.569 1.196-3.475 2.318l-.453.599-.455-.599c-.906-1.122-2.04-1.943-3.475-2.318-2.342-.448-4.457.524-5.74 2.617-.844 1.408-.937 2.8-.75 4.197.214 1.596 1.24 3.284 2.344 4.425.814.84 8.079 7.654 8.079 7.654 2.263-2.094 7.257-6.814 8.07-7.654 1.105-1.141 2.132-2.83 2.346-4.425.186-1.397.092-2.79-.75-4.197Z"/></svg>`)),te={id:"PersonalizationFavorites",monochrome:!0,grayscale:!1,fullColor:!1,fills:["#cc0000"],nameComponents:{name:"Favorites",category:"Personalization",variant:null}},re=e=>{var t;const r=(0,X.L)("nds-Icon"),n=ee({idPrefix:null!==(t=e.id)&&void 0!==t?t:r});return o.createElement(X.J,Object.assign({},e,{svgData:n,svgMetadata:te}))};re.metadata=te,re.displayName="IconPersonalizationFavorites";var ne=r(85080),oe=r(19521),ie=r(81668);const se=oe.ZP.button.withConfig({displayName:"styles__FavoritesButtonStyled",componentId:"sc-19se466-0"})(["border-radius:50%;display:inherit;padding:3px;border:1px solid ",";background-color:",";background-image:none;position:relative;font-size:0;touch-action:manipulation;cursor:pointer;user-select:none;> span{position:relative;top:1px;}&:active > svg{opacity:0.8;transform:scale(0.8);path{fill:",";}}"],ie.colors.palette.gray.light,ie.colors.palette.white,ie.colors.palette.red.default);var ae;!function(e){e.search="search",e.recommendations="recommendations",e.bia="bia"}(ae||(ae={}));const ce=(0,o.createContext)({placementType:ae.search}),le={unlovedMessage:(0,n.jsx)("div",{children:"Click to sign in and save"}),lovedMessage:(0,n.jsx)("div",{children:"Signing in ..."}),stickyJustLovedMessage:(0,n.jsx)("div",{children:"Signing in ..."})},ue={unlovedMessage:(0,n.jsx)("div",{children:"Favorite to keep tabs on it"}),lovedMessage:(0,n.jsx)("div",{children:"Remove it from your \u2665s"}),stickyJustLovedMessage:(0,n.jsxs)("div",{children:["Favorited!\xa0",(0,n.jsx)(i.r,{href:"/yr/crush",underline:"always",children:"See all of your \u2665s"})]})},de=(0,o.memo)((({tcin:e,cartOnUnFavoriteCallback:t})=>{var r,i,d;const v=(0,u.rS)(),p=(0,l.Pd)(),f=(0,l.MP)(),m=!p||f,{placementType:b}=(0,o.useContext)(ce),[g]=x({},{enabled:!0}),y=null===(r=g())||void 0===r||null===(i=r.list_items)||void 0===i?void 0:i.filter(R.y),O=(0,W.ct)(G.hg),h=(0,W.Ao)(G.hg),j=null!==(d=null!==O&&void 0!==O?O:h)&&void 0!==d?d:e,w=(0,Q.T)(),P=(0,o.useCallback)((e=>"TCIN"===(null===e||void 0===e?void 0:e.item_type)&&(null===e||void 0===e?void 0:e.tcin)===j),[j]),_=(0,o.useMemo)((()=>null===y||void 0===y?void 0:y.some((e=>P(e)))),[P,y]);(0,o.useEffect)((()=>{E(_)}),[_]);const k=m?le:ue,{0:D,1:C}=(0,o.useState)(""),{0:M,1:T}=(0,o.useState)(!1),{0:N,1:E}=(0,o.useState)(_),S=(0,s.L)("favorites-button-"),F=(0,o.useRef)(null),L=(0,o.useCallback)((e=>F.current=e),[F]),Z=(0,o.useRef)(null),J=(0,o.useRef)(null),z=(0,o.useCallback)((()=>{var e;T(!1),null===(e=J.current)||void 0===e||e.focus()}),[]),U=(0,o.useCallback)((()=>{var e;D===k.stickyJustLovedMessage&&(null===(e=Z.current)||void 0===e||e.focus())}),[D,k.stickyJustLovedMessage]),[A]=I(),B=(0,o.useCallback)((async()=>{j&&(m||v.trackEvent({guest:{eventType:"click"},crush:{lovedItems:{removed:!1},loved:!0},products:[{tcin:j,placementType:b}]}),A({tcin:j,item_note:"",item_type:"TCIN"},{onAuthRejected:()=>{(0,l.zB)()}}))}),[j,m,b,v,A]),[q]=H(),V=(0,o.useCallback)((async()=>{var r;if(!j)return;m||v.trackEvent({guest:{eventType:"click"},crush:{lovedItems:{removed:!0},loved:!1},products:[{tcin:j,placementType:b}]});const n=null===y||void 0===y||null===(r=y.find((e=>(null===e||void 0===e?void 0:e.tcin)===j)))||void 0===r?void 0:r.list_item_id;n&&q({list_item_id:n},{onAuthRejected:()=>{(0,l.zB)()}}).then((r=>{r&&e&&t&&t()}))}),[j,m,y,v,b,q,e,t]),$=(0,o.useCallback)((()=>{setTimeout((()=>{M||(N?(T(!0),C(k.lovedMessage)):(T(!0),C(k.unlovedMessage)))}),0)}),[N,k,M]),K=(0,o.useCallback)((()=>{const e=!N;T(!1),E(e),setTimeout((()=>{e?(T(!0),C(k.stickyJustLovedMessage)):(T(!0),C(k.unlovedMessage))}),0),B&&e&&B(),V&&!e&&V()}),[N,k,B,V]),X=(0,o.useCallback)((()=>{D!==k.stickyJustLovedMessage&&T(!1)}),[k,D]),Y=(0,o.useCallback)((e=>{var t;const r=null===e||void 0===e?void 0:e.relatedTarget;!r||!F.current||null!==(t=F.current)&&void 0!==t&&t.contains(r)||T(!1)}),[F]),ee=(e=>{const{title:t="this item",isFavorited:r,isAnonymous:n}=e;return r?`remove ${t} from your favorites`:`${n?"sign in to ":""}favorite ${t} to keep tabs on it`})({title:w,isFavorited:N,isAnonymous:m}),te=!(0,a.tq)()&&!(0,a.zc)();return(0,n.jsxs)("div",{className:"h-display-inline-block",onMouseEnter:$,onMouseLeave:X,children:[te&&(0,n.jsx)(c.J,{childRef:L,isDismissible:D===k.stickyJustLovedMessage,isOpen:M,onDismiss:z,onOpen:U,placement:"top",target:S,toggle:Y,variant:"secondary",children:(0,n.jsx)("div",{className:"h-text-center",ref:Z,tabIndex:-1,children:D})}),(0,n.jsx)(se,{"aria-label":ee,"data-test":"FavoritesButton",id:S,onBlur:Y,onClick:K,onFocus:$,ref:J,type:"button",children:N?(0,n.jsx)(re,{"data-test":"PersonalizationFavorites",size:24}):(0,n.jsx)(ne.k,{"data-test":"IconGeneralHeartOutline",size:24})})]})}));de.displayName="FavoritesButton"},85080:function(e,t,r){r.d(t,{k:function(){return l}});var n=r(67294),o=r(53131),i=r(93862);let s;const a=(0,o.No)(s||(s=(e=>e)`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation"><path d="M21.281 9.076c-.317 1.427-1.031 2.776-2.142 3.966a108.712 108.712 0 0 1-4.284 4.284c-.872.872-1.824 1.745-2.776 2.618l-.08.08-.079-.08c-.952-.873-1.904-1.746-2.776-2.618a108.137 108.137 0 0 1-4.283-4.284c-1.111-1.19-1.825-2.539-2.142-3.966-.397-1.666.158-2.856.635-3.57.696-1.046 1.903-1.81 3.18-1.895 2.027-.136 3.465 1.45 4.498 2.982.29.43.603.847.9 1.274l.068.099.068-.099c.296-.427.609-.843.9-1.274 1.033-1.531 2.47-3.118 4.497-2.982 1.278.085 2.484.849 3.181 1.895.477.714 1.032 1.904.635 3.57M12 5.004a6.535 6.535 0 0 0-1.476-1.72c-1.207-1.003-3.06-1.661-4.632-1.269-2.46.397-5.553 3.253-4.76 7.298.352 1.799 1.321 3.41 2.539 4.755 1.376 1.52 2.868 2.951 4.363 4.369A203.883 203.883 0 0 0 12 22.1a201.526 201.526 0 0 0 3.966-3.663c1.496-1.418 2.986-2.848 4.362-4.369 1.219-1.345 2.187-2.956 2.54-4.755.793-4.045-2.301-6.9-4.76-7.298-1.571-.392-3.425.266-4.633 1.27A6.532 6.532 0 0 0 12 5.004"/></svg>`)),c={id:"GeneralHeartOutline",monochrome:!0,grayscale:!1,fullColor:!1,fills:["#333333"],nameComponents:{name:"HeartOutline",category:"General",variant:null}},l=e=>{var t;const r=(0,i.L)("nds-Icon"),o=a({idPrefix:null!==(t=e.id)&&void 0!==t?t:r});return n.createElement(i.J,Object.assign({},e,{svgData:o,svgMetadata:c}))};l.metadata=c,l.displayName="IconGeneralHeartOutline"}}]);