(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5409],{35409:function(e,r,t){"use strict";t.d(r,{QUERY_KEY_GET_PLP_SEARCH_V2:function(){return N},preloadPlpSearchV2Query:function(){return K},usePlpSearchV2QueryVariables:function(){return x},usePlpSearchV2QueryWithVariables:function(){return Y}});t(78291);var o=t(59499),i=t(41609),a=t.n(i),n=t(96012),s=t(81626),u=t(1344),d=t(35963),l=t(76291),c=t(88141),_=t(92354),p=t(1883),v=t(62282),f=t(10341),y=t(84601),h=t(64595),b=t(67294),m=t(11163),P=t(18426),g=t(32790),w=t(13338),E=t(20195),S=t(22026),O=t(1811),k=t(18136),j=t(28825),I=t(26098),R=t(74965),A=t(50794);const q=e=>{if(!e.asPath)return;const r=(0,I.EG)(e.asPath),t=(0,I.jI)(e.query,"category"),o=(0,A.Yq)(e.asPath),i=(0,A.$L)(e.asPath),a=(0,A.O_)(e.asPath),n=(0,I.jI)(e.query,"auto_recover"),s="true"===(0,I.jI)(e.query,"facetRecovery")||void 0,u=(0,A.PC)(e),d=(0,I.lW)(e.query),l=(0,I.jI)(e.query,"kwr"),c=(0,I.jI)(e.query,"marketing_id"),_=(0,I.jI)(e.query,"maxPrice"),p=(0,I.jI)(e.query,"minPrice"),v=(0,I.jI)(e.query,"Nao"),f=(0,R.ew)(e.asPath),y=(0,I.jI)(e.query,"sortBy"),h="true"===(0,I.jI)(e.query,"splchkoff")||void 0,b=(0,I.jI)(e.query,"storeIdList");return{auto_recover:n,brand:o,brand_id:i,category:null!==t&&void 0!==t?t:i?void 0:r,facet_recovery:s,faceted_value:u,keyword:d,kwr:l,marketing_id:c,max_price:_,min_price:p,offset:Number.parseInt(null!==v&&void 0!==v?v:"",10)||0,page:f,promo_id:a,sort_by:y,splchkoff:h,store_ids:b}};var G=t(40554),L=t.n(G);const C=/^\d{3}[ -]\d{2}[ -]\d{4}$/,V=(e,r)=>e&&(!r||!(e=>{const r=e.trim().length;return L()(e)>0&&r>4&&r<11})(r)&&!(e=>C.test(e))(r));function D(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function T(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?D(Object(t),!0).forEach((function(r){(0,o.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const N="@web/domain-product/get-plp-search-v2",Q=new Set(["scheduled_delivery_store_id"]),W={},x=(e={})=>{var r;const{shouldNotWaitForCorrectVariablesOnHardRoute:t}=e,o=(0,m.useRouter)(),i=(0,b.useMemo)((()=>q(o)),[o]),{guestLocation:n,queryState:s}=(0,w.N)(),{zipCode:d}=null!==n&&void 0!==n?n:{},{preferredStoreId:l,queryState:c}=(0,E.lo)(),_=null!==l&&void 0!==l?l:g.AP,{store_ids:p,enabled:v}=(0,k.P)(),f=V(Boolean(p),null===i||void 0===i?void 0:i.keyword),h=f?p:void 0,{scheduledDeliveryStoreId:I,queryState:R}=(0,S.G3)(),A=(0,P.Pd)(),G=(0,P.bC)(),L=Boolean(null===i||void 0===i||null===(r=i.faceted_value)||void 0===r?void 0:r.includes(j.lL)),{include_sponsored:C,enabled:D}=(0,u.f)(),N=A&&D&&v&&(c.status===y.o.Success||c.status===y.o.Error)&&(s.status===y.o.Success||s.status===y.o.Error),x=N&&(!L||(R.status===y.o.Success||R.status===y.o.Error)),H=N&&(R.status===y.o.Success||R.status===y.o.Error),Y=(0,b.useMemo)((()=>T(T({},i),{},{default_purchasability_filter:null===f||void 0===f?void 0:f.toString(),include_sponsored:!!C||void 0,member_id:G,pricing_store_id:_,scheduled_delivery_store_id:I,store_ids:h,zip:d})),[i,f,C,G,_,I,h,d]),K=a()(W.value)?[]:Object.entries(Y).filter((([e,r])=>{var t;return r!==(null===(t=W.value)||void 0===t?void 0:t[e])})).map((([e])=>e)),z=K.some((e=>!Q.has(e))),B=(0,O.A)(),U=t&&!B,$=W.value&&U&&!z?W.value:Y;return(0,b.useMemo)((()=>({variables:U?$:Y,enabled:U?x:H})),[U,$,x,Y,H])},{useQuery:H}=(0,h.J)({name:N,defaultOptions:{staleTime:9e5,cacheTime:9e5,keepPreviousData:!0},keyFn:e=>{var r;return[N,T(T({},e),{},{offset:null===e||void 0===e||null===(r=e.offset)||void 0===r?void 0:r.toString()})]},queryFn:async e=>{W.value||(W.value=e);const{apiKey:r,baseUrl:o,apis:{product:{endpointPaths:i}}}=(0,n.asConfigV2)(n.config).services.redskyAggregations,a=null===i||void 0===i?void 0:i.plpSearchV2;if(!a)throw new Error("path not defined for plpSearchV2 query");const u=await(0,l.W)(),{auto_recover:d,brand:y,brand_id:h,category:b,default_purchasability_filter:m,facet_recovery:P,faceted_value:w,include_sponsored:E,keyword:S,kwr:O,marketing_id:k,max_price:j,member_id:I,min_price:R,offset:A,page:q,pricing_store_id:G=g.AP,promo_id:L,scheduled_delivery_store_id:C,skip_price_promo:V,sort_by:D,splchkoff:N,store_ids:Q,zip:x}=null!==e&&void 0!==e?e:{};if(A&&A>=1500)throw new Error("Offset too high for plpSearchV2 query");const H=(0,p.WE)(),Y=(0,s.k)()||"0",K={key:r,effective_date:u,auto_recover:d,brand:y,brand_id:h,category:b&&!b.includes("|")?b:void 0,channel:"WEB",count:24,default_purchasability_filter:m,facet_recovery:P,faceted_value:w,include_sponsored:E,keyword:S,kwr:O,marketing_id:k,max_price:j,member_id:I,min_price:null!==R&&void 0!==R?R:j?"0":void 0,offset:A,page:q,platform:(0,v.o$)(),pricing_store_id:G,promo_id:L,scheduled_delivery_store_id:C,skip_price_promo:V,sort_by:D,splchkoff:N,store_ids:Q,useragent:H,visitor_id:Y,zip:x},z=_.Z.buildURLWithParams(a,K,o),{data:B,ok:U,statusText:$}=await(0,c.G)(z,{errorTag:f.jD.REDSKY_AGGREGATIONS_PLP_SEARCH_API_ERROR,partialErrorTag:f.jD.REDSKY_AGGREGATIONS_PLP_SEARCH_PARTIAL_API_ERROR,timerTag:f.sO.REDSKY_AGGREGATIONS_PLP_SEARCH_API_CALL,importQuerySource:()=>t.e(8408).then(t.t.bind(t,15225,17))});if(U)return T(T({},null===B||void 0===B?void 0:B.data),null===B||void 0===B?void 0:B.extensions);throw new Error(`${$}`)}}),Y=(e,r={})=>{const{variables:t,enabled:o}=x(r);return H(T(T({},r.shouldUseOnlyVariableOverrides?{}:t),e),{enabled:!1!==r.enabled&&o})},K=async(e,r)=>{const t=T(T({},q(e)),{},{default_purchasability_filter:"false",pricing_store_id:g.AP},r);try{var o;const r=await e.preloadInitialQuery(H,t),s=null===r||void 0===r||null===(o=r.data)||void 0===o?void 0:o.search,u=(0,d.th)(s);var i,a,n;if(u)null===(i=e.res)||void 0===i||i.writeHead(302,{Location:u}),null===(a=e.res)||void 0===a||a.end();if(null!==r&&void 0!==r&&r.error)throw new Error(null===r||void 0===r||null===(n=r.error)||void 0===n?void 0:n.message);return t}catch(s){return}}},78291:function(){}}]);